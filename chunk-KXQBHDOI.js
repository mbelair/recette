import{a as z,b as N}from"./chunk-WRZM4GAF.js";import{a as j}from"./chunk-PWI5DRZD.js";import{k as R}from"./chunk-LWGMSCV3.js";import"./chunk-VN2TDJQ5.js";import{c as O,d as k,j as P,k as a,p as V}from"./chunk-4AMG6IFK.js";import{$b as D,Ba as m,Ca as b,Cb as S,Db as q,Fb as L,Gb as $,Ra as d,Rd as A,Sd as H,Ua as c,_b as F,bb as s,cb as l,cc as w,db as h,dc as B,ha as v,hb as I,kb as x,mb as p,oa as E,pa as y,t as C,ub as f,vb as T,wb as M,za as _}from"./chunk-KJHA3E4B.js";var g=class r{getLabel(){let n="";this.quantite&&(n+=this.quantite+" ");let t=a.fromTypeCode(this.unite).getFormatedLabel(this.quantite>1),e=this.convertToImperial();return e&&(t=`${t} (${e})`),this.recette?`${n}${t} ${this.nom} <b>(${this.recette.nom})</b>`:`${n}${t} ${this.nom}`}convertToImperial(){let n=a.fromTypeCode(this.unite);if(n===a.ML){if(this.quantite%250===0){let t=this.quantite/250;return`${t} ${a.TASSE.getFormatedLabel(t>1)}`}if(this.quantite%125===0){let t=0,e=this.quantite/125;for(;e>1;)t++,e-=2;return`${t===0?"\xBD":`${t} \xBD`} ${a.TASSE.getFormatedLabel(t>1)}`}if(this.quantite%80===0){let t=0,e=this.quantite/80;for(;e>2;)t++,e-=3;let i="";return e===1?i="\u2153":e===2&&(i="\u2154"),`${t===0?i:`${t} ${i}`} ${a.TASSE.getFormatedLabel(t>1)}`}if(this.quantite%60===0){let t=0,e=this.quantite/60;for(;e>3;)t++,e-=4;let i="";return e===1?i="\xBC":e===2?i="\xBD":e===3&&(i="\xBE"),`${t===0?i:`${t} ${i}`} ${a.TASSE.getFormatedLabel(t>1)}`}if(this.quantite%30===0){let t=0,e=this.quantite/30;for(;e>7;)t++,e-=8;let i="";return e===1?i="\u215B":e===2?i="\xBC":e===3?i="\u215C":e===4?i="\xBD":e===5?i="\u215D":e===6?i="\xBE":e===7&&(i="\u215E"),`${t===0?i:`${t} ${i}`} ${a.TASSE.getFormatedLabel(t>1)}`}if(this.quantite%15===0){let t=this.quantite/15;return`${t} ${a.C_A_SOUPE.getFormatedLabel(t>1)}`}if(this.quantite%5===0){let t=this.quantite/5;return`${t} ${a.C_A_THE.getFormatedLabel(t>1)}`}}else if(n===a.G){let t=this.quantite/450;return`${Intl.NumberFormat("fr-CA",{maximumSignificantDigits:2}).format(t)} ${a.LB.getFormatedLabel(t>1)}`}return""}static fromIngredientRecette(n,t){let e=new r;return e.ingredient_Id=n.ingredient_Id,e.quantite=n.quantite,e.unite=n.unite,e.nom=n.ingredient.nom,e.category=n.ingredient.category,e.recette=t,e}static fromIngredientListeEpicerie(n){let t=new r;return t.ingredient_Id=n.ingredient_Id,t.quantite=n.quantite,t.unite=n.unite,t.nom=n.nom,t.category=n.category,t}};var K=r=>[r];function Q(r,n){if(r&1){let t=I();s(0,"li"),f(1),s(2,"button",1),x("click",function(){let i=E(t).$implicit,o=p();return y(o.openDeleteRecetteDialog(i))}),h(3,"mat-icon",2),l()()}if(r&2){let t=n.$implicit;m(),M(" ",t.nom," ")}}function J(r,n){if(r&1&&(s(0,"li"),h(1,"span",5),l()),r&2){let t=n.$implicit,e=p(4);m(),c("innerHTML",e.formatIngredient(q(1,K,t)),_)}}function W(r,n){if(r&1&&(s(0,"ul",7),d(1,J,2,3,"li",0),l()),r&2){let t=p().$implicit;m(),c("ngForOf",t.value)}}function X(r,n){if(r&1&&(s(0,"li")(1,"mat-checkbox",4),h(2,"span",5),d(3,W,2,1,"ul",6),l()()),r&2){let t=n.$implicit,e=p(2);m(2),c("innerHTML",e.formatIngredient(t.value),_),m(),c("ngIf",t.value.length>1)}}function Y(r,n){if(r&1&&(s(0,"div")(1,"h3"),f(2),l(),s(3,"ul",3),d(4,X,4,2,"li",0),L(5,"keyvalue"),l()()),r&2){let t=n.$implicit,e=p();m(2),T(e.getCategoryLabel(t.key)),m(2),c("ngForOf",$(5,2,t.value))}}var he=(()=>{let n=class n{constructor(e,i){this.service=e,this.dialog=i,this.recettes=[],this.displayedColumns=["nom"],this.ingredientList=null,this.getCategoryLabel=P}ngOnInit(){C([this.service.getAllRecettes(),this.service.listeEpicerie]).subscribe({next:([e,i])=>{this.recettes=e.filter(o=>i.includes(o.id)),this.computeIngredientList()}})}computeIngredientList(){this.ingredientList=new Map,this.recettes.forEach(e=>{e.categorieIngredient.flatMap(i=>i.ingredient).forEach(i=>{let o=null,u=null;this.ingredientList.has(i.ingredient.category)?u=this.ingredientList.get(i.ingredient.category):u=new Map,u.has(i.ingredient_Id)?o=u.get(i.ingredient_Id):o=[],o.push(g.fromIngredientRecette(i,e)),o.sort((G,U)=>G.recette.nom.localeCompare(U.recette.nom)),u.set(i.ingredient_Id,o),this.ingredientList.set(i.ingredient.category,u)})})}formatIngredient(e){if(e.length===1)return e[0].getLabel();if(new Set(e.map(i=>i.unite)).size===1){let i=g.fromIngredientListeEpicerie(e[0]);for(let o=1;o<e.length;o++)i.quantite+=e[o].quantite;return i.getLabel()}return e[0].nom}openDeleteRecetteDialog(e){this.dialog.open(j,{data:{title:`Supprimer ${e.nom} de la liste d'\xE9picerie`}}).afterClosed().subscribe(o=>{o&&this.service.removeFromListeEpicerie(e)})}};n.\u0275fac=function(i){return new(i||n)(b(V),b(R))},n.\u0275cmp=v({type:n,selectors:[["app-liste-epicerie"]],standalone:!0,features:[S],decls:10,vars:4,consts:[[4,"ngFor","ngForOf"],["mat-icon-button","","color","primary",3,"click"],["fontIcon","delete"],[1,"nobullet"],["color","primary"],[3,"innerHTML"],["class","bullet",4,"ngIf"],[1,"bullet"]],template:function(i,o){i&1&&(s(0,"h1"),f(1,"Liste d'\xE9picerie"),l(),s(2,"h2"),f(3,"Recettes inclues"),l(),s(4,"ul"),d(5,Q,4,1,"li",0),l(),s(6,"h2"),f(7,"Liste d'ingr\xE9dients"),l(),d(8,Y,6,4,"div",0),L(9,"keyvalue")),i&2&&(m(5),c("ngForOf",o.recettes),m(3),c("ngForOf",$(9,2,o.ingredientList)))},dependencies:[B,F,D,w,H,A,k,O,N,z],styles:["b{font-weight:550}h3[_ngcontent-%COMP%], h2[_ngcontent-%COMP%]{margin-bottom:0}ul[_ngcontent-%COMP%]{margin:0}ul.nobullet[_ngcontent-%COMP%]{list-style-type:none}.mat-mdc-checkbox-checked[_ngcontent-%COMP%]     label{color:#888;text-decoration:line-through}"]});let r=n;return r})();export{he as ListeEpicerieComponent};
